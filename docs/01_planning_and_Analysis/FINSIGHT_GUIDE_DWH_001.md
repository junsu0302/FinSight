# 데이터 요구사항 및 DWH 설계 명세서 가이드

| 문서 ID       | FINSIGNT-GUIDE-DWH-001 |
| :------------ | :--------------------- |
| **문서 버전** | 1.0                    |
| **프로젝트**  | FinSight               |
| **작성자**    | FinSight-Navigator     |
| **작성일**    | 2025년 9월 15일        |

---

## 1. 문서 개요

본 문서는 FinSight 프로젝트의 분석 및 모델링 목적을 달성하기 위해 구축될 **데이터 웨어하우스(Data Warehouse, DWH)의 요구사항과 논리적/물리적 구조를 정의**하는 표준 가이드이다.

이 명세서는 데이터 분석가의 요구사항을 실제 데이터베이스 스키마로 변환하는 청사진 역할을 한다. 이 문서를 통해 우리는 데이터의 정합성을 보장하고, 쿼리 성능을 최적화하며, 향후 확장성을 고려한 견고한 분석 데이터 저장소를 구축하는 것을 목표로 한다.

---

## 2. 작성 원칙

1.  **요구사항 기반 (Requirement-Driven)**: DWH에 존재하는 모든 테이블, 컬럼, 관계는 명시된 데이터 요구사항을 만족시키기 위해 존재해야 한다.
2.  **단일 진실의 원천 (Single Source of Truth)**: DWH는 프로젝트의 모든 분석과 모델링을 위한 표준화되고 정제된 **'단일 진실의 원천'** 으로 기능해야 한다.
3.  **주제 중심적 설계 (Subject-Oriented)**: '종목', '일자별 시세', '재무' 등 분석의 핵심 주제를 중심으로 데이터를 모델링하여 사용자의 이해와 접근을 용이하게 한다.
4.  **성능과 확장성 고려**: 대용량 데이터 조회의 성능을 고려하여 인덱싱, 파티셔닝 전략을 수립하고, 향후 새로운 데이터 소스나 피처가 추가될 것을 대비한 유연한 구조로 설계한다.

---

## 3. 명세서 필수 구성 요소

DWH 설계 명세서는 아래의 구조를 따라 작성되어야 한다.

### 3.1. 개요 (Overview)

- **DWH 구축 목적**: DWH가 해결하고자 하는 핵심 문제를 기술한다.
  > 예: 뉴스 이벤트 기반 변동성 예측 모델 개발 및 리스크 관리 전략 백테스팅을 효율적으로 지원하기 위한 통합 분석 환경을 구축한다.
- **데이터 범위**: DWH가 포함할 데이터의 종류와 시간적 범위를 명시한다.
  > 예: 국내 KOSPI/KOSDAQ 상장 전 종목의 2015년부터 현재까지의 일별 시세, 분기별 재무, 뉴스 이벤트 데이터.

### 3.2. 데이터 요구사항 목록 (Data Requirements List)

DWH가 반드시 충족해야 하는 기능적/비기능적 요구사항을 명확하게 목록화한다.

- `R-01`: 모델 학습을 위해 특정 기간, 특정 종목의 시계열 피처(기술적/기본적/이벤트)를 빠르게 조회할 수 있어야 한다.
- `R-02`: 특정 시점의 전체 시장 또는 특정 섹터의 팩터(예: PBR) 값을 기준으로 종목을 스크리닝할 수 있어야 한다.
- `R-03`: 백테스팅 시뮬레이션을 위한 포트폴리오 수익률 계산을 효율적으로 지원해야 한다.
- `R-04`: 데이터는 매일 1회 업데이트되어야 하며, 데이터의 정합성이 보장되어야 한다.

### 3.3. 논리적 스키마 설계 (Logical Schema Design)

요구사항을 만족시키기 위한 데이터의 구조와 관계를 추상적으로 설계한다. **ERD(Entity-Relationship Diagram)**와 함께 **스타 스키마(Star Schema)** 모델을 사용하는 것을 강력히 권장한다.

- **스타 스키마 개념**:

  - **사실 테이블 (Fact Table)**: 분석의 대상이 되는 측정값, 지표, '사실'을 담는 중심 테이블. (예: `일별 종목 피처`)
  - **차원 테이블 (Dimension Table)**: 사실 테이블의 데이터에 대한 맥락(Context)을 제공하는 테이블. (예: `종목 마스터`, `날짜 정보`)

- **FinSight DWH 스키마 예시**:
  - **`fact_daily_features` (사실 테이블)**: `일자`, `종목코드`를 기준으로 모든 분석 피처를 통합.
    - (PK: `date`, `stock_code`), `close_price`, `volume`, `ma20`, `rsi`, `pbr`, `event_sentiment_score` 등
  - **`dim_stock_master` (차원 테이블)**: 자주 변경되지 않는 종목의 마스터 정보.
    - (PK: `stock_code`), `stock_name`, `sector`, `market_type` 등
  - **`dim_date` (차원 테이블)**: 날짜 관련 모든 속성 정보.
    - (PK: `date`), `year`, `month`, `day`, `day_of_week`, `is_weekday` 등

### 3.4. 물리적 스키마 설계 (Physical Schema Design)

논리적 설계를 PostgreSQL 데이터베이스에 구현하기 위한 구체적인 명세를 작성한다. 모든 테이블에 대해 아래 형식의 명세서를 작성한다.

**테이블명: `fact_daily_features`**

| 컬럼명        | 데이터 타입  | 제약 조건                 | 설명                                                |
| :------------ | :----------- | :------------------------ | :-------------------------------------------------- |
| `date`        | `DATE`       | `PRIMARY KEY`, `NOT NULL` | 기준 일자 (FK to dim_date.date)                     |
| `stock_code`  | `VARCHAR(6)` | `PRIMARY KEY`, `NOT NULL` | 6자리 종목 코드 (FK to dim_stock_master.stock_code) |
| `close_price` | `BIGINT`     | `NOT NULL`                | 수정주가 기준 종가                                  |
| `ma_20d`      | `FLOAT8`     |                           | 20일 종가 이동평균                                  |
| `pbr`         | `FLOAT8`     |                           | 주가순자산비율                                      |

### 3.5. ETL 흐름 정의 (ETL Flow Definition)

원천 데이터(Data Lake)가 어떤 과정을 거쳐 DWH에 적재되는지를 기술한다. 간단한 순서도나 다이어그램으로 표현하는 것이 효과적이다.

> **예시**:
>
> 1.  **[Extract]** KIS API로부터 원천 데이터를 수집하여 Data Lake(`rawdb`)에 적재.
> 2.  **[Transform]** Staging 영역에서 데이터 정의서(`DD`)와 EDA 보고서 결과를 바탕으로 데이터 정제, 피처 계산, 테이블 조인 등 변환 작업 수행.
> 3.  **[Load]** 변환된 최종 데이터를 DWH의 `fact` 및 `dim` 테이블에 적재.

### 3.6. 성능 최적화 전략 (Performance Optimization Strategy)

대용량 데이터 처리 성능을 확보하기 위한 전략을 명시한다.

- **인덱싱(Indexing)**: `FOREIGN KEY`로 사용되는 모든 컬럼과, `WHERE` 절에서 자주 사용되는 조회 조건 컬럼에 인덱스를 생성한다.
- **파티셔닝(Partitioning)**: `fact_daily_features`와 같이 행의 개수가 매우 많은 사실 테이블은 **`date` 컬럼을 기준으로 월별 또는 연별로 파티셔닝**하여 조회 성능을 향상시킨다.
